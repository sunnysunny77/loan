<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="description" content="Credit Risk Prediction Form and Data" />
  <meta name="keywords" content="AI ML Credit Risk" />
  <meta name="author" content="D>C" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Give me some credit</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="images/pwa-logo-small.webp" />
  <style>
   
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f7f9;
    }

    header {
      background-color: #3c6464;
      color: white;
      padding: 20px;
      text-align: center;

    }
    header h1 {
      font-size: 23px;
      margin: 0;
    }

    .container {
      display: flex;
      flex-wrap: wrap; 
      max-width: 1200px;
      margin: 20px auto;
      gap: 20px;
      padding: 0 10px;
    }

    .input-panel, .data-panel {
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .input-panel {
      flex: 1; 
      min-width: 300px;
    }

    .data-panel {
      flex: 2; 
      min-width: 450px;
      display: flex; 
      flex-direction: column;
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr; 
      gap: 15px;
      padding-bottom: 20px;
    }

    label {
      grid-column: 1 / 2;
      font-weight: bold;
      color: #333;
      align-self: center;
    }

    input[type="number"] {
      grid-column: 2 / 3;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      width: 100%;
    }

    button[type="submit"] {
      grid-column: 1 / 3; 
      padding: 12px;
      background-color: #3c6464;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1.1em;
      margin-top: 10px;
      transition: background-color 0.3s;
    }

    button[type="submit"]:hover {
      background-color: #3c5364;
    }


    .data-panel h2 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    #output-result {
      padding: 15px;
      border: 2px solid #3c6464;
      border-radius: 4px;
      background-color: #e6f2ff; 
      font-size: 1em;
      font-weight: bold;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      color: #3c6464;
      grid-column: 1 / 3;
      min-height: 44px;
    }

    .switcherContent {
      display: none;
    }

  </style>
</head>

<body>
    <header>
        <h1>Credit Risk Predictor</h1>
    </header>

    <div class="container">
        
        <div class="input-panel">
            <h2>Enter Customer Data</h2>
            <form>
                <label for="RevolvingUtilizationOfUnsecuredLines">Revolving Utilization:</label>  
                <input type="number" step="any" name="RevolvingUtilizationOfUnsecuredLines" id="RevolvingUtilizationOfUnsecuredLines">

                <label for="age">Age:</label>
                <input type="number" name="age" id="age">

                <label for="NumberOfTime30-59DaysPastDueNotWorse">30-59 Days Past Due:</label>
                <input type="number" name="NumberOfTime30-59DaysPastDueNotWorse" id="NumberOfTime30-59DaysPastDueNotWorse">

                <label for="DebtRatio">Debt Ratio:</label>
                <input type="number" step="any" name="DebtRatio" id="DebtRatio">

                <label for="MonthlyIncome">Monthly Income:</label>
                <input type="number" step="any" name="MonthlyIncome" id="MonthlyIncome">

                <label for="NumberOfOpenCreditLinesAndLoans">Open Credit Lines:</label>
                <input type="number" name="NumberOfOpenCreditLinesAndLoans" id="NumberOfOpenCreditLinesAndLoans">

                <label for="NumberOfTimes90DaysLate">90 Days Late:</label>
                <input type="number" name="NumberOfTimes90DaysLate" id="NumberOfTimes90DaysLate">

                <label for="NumberRealEstateLoansOrLines">Real Estate Loans:</label>
                <input type="number" name="NumberRealEstateLoansOrLines" id="NumberRealEstateLoansOrLines">

                <label for="NumberOfTime60-89DaysPastDueNotWorse">60-89 Days Past Due:</label>
                <input type="number" name="NumberOfTime60-89DaysPastDueNotWorse" id="NumberOfTime60-89DaysPastDueNotWorse">

                <label for="NumberOfDependents">Dependents:</label>
                <input type="number" name="NumberOfDependents" id="NumberOfDependents">

                <button type="submit">Predict Credit Risk</button>

                <div id="output-result">
                  <span style="color: #3c6464;">
                      Awaiting input..
                  </span>
                </div>

            </form>
        </div>

        <div class="data-panel">
            <h2>Data Context</h2>
            <iframe
              title="cs-training"
              width="100%"
              height="100%"
              frameborder="0"
              src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTIauMNyS8dSeUoLy2JmqWwkGnCoXVQyjEhiFdFv8iEu7MjeQbL8O0iZ4Ld9fTZ8b496AGuICwocdRB/pubhtml?gid=2019426775&amp;single=true&amp;widget=true&amp;headers=false&amp;chrome=false&amp;range=A1:L101">
            </iframe>
        </div>

    </div>

</body>

<script>

  const host = "http://127.0.0.1:8001";
  const form = document.querySelector("form");
  const resultDiv = document.getElementById("output-result"); 

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    resultDiv.innerHTML = "Calculating prediction..."; 

    const formData = new FormData(form);
    const payload = { data: {} };

    formData.forEach((value, key) => {
      payload.data[key] = value === "" ? null : parseFloat(value);
    });

    try {
      const response = await fetch(`${host}/predict`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.json();
      
      const prediction = result.predictions[0];
      const probability = result.probabilities[0].toFixed(3);
      
      resultDiv.innerHTML = `
          <span style="color: ${prediction === 1 ? '#cc0000' : '#3c6464'};">
              ${prediction === 1 ? 'High Risk ( Default )' : 'Low Risk ( Repay )'}
          </span>
          Probability: ${probability}
      `;
      
    } catch (error) {
      console.error("Prediction failed:", error);
      resultDiv.innerHTML = `<span style="color: red;">Error: Could not connect to the prediction service (${error.message}).</span>`;
    }
  });

</script>

</html>